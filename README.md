# Paper Writer - 智能学术论文写作系统

基于两级AI Agent协作的学术论文写作工具，采用先进的分层架构：一级AI生成详细写作指导，二级AI根据指导进行精准写作。支持完整的论文写作流程，从研究内容提取到最终质量检查。

## ✨ 核心功能

| 功能 | 描述 |
|------|------|
| 🧠 **两级AI协作** | 一级AI生成详细写作skill，二级AI精准执行 |
| 📄 **智能文档解析** | 深度解析Word文档，AI自动分析图表和表格 |
| 📊 **图表AI分析** | GPT-4o Vision分析图片，智能提取数据洞察 |
| 📚 **智能文献管理** | 句子级文献搜索，质量优先选择，自动引用 |
| 🎯 **章节特定风格** | 各章节使用对应风格指南，确保风格一致性 |
| ✅ **最终质量检查** | 一级AI最终审阅，微调不符合要求的表达 |
| 🤖 **模型灵活配置** | 支持多模型并行，各章节独立配置 |
| 📝 **LaTeX输出** | 直接生成学术出版级别的LaTeX格式 |

## 🚀 快速开始

### 1. 运行Web界面

```bash
cd paper_writer
streamlit run app.py
```

访问 `http://localhost:8501` 打开网页界面。

### 2. 配置API

系统需要配置两个API服务：

#### 主要模型API（模型中转站）
- **推荐服务**: ModelGate (https://modelgate.cn)
- **API URL**: `https://modelgate.cn/v1` 或其他模型中转站地址
- **API Key**: 从ModelGate获取的API密钥
- **用途**: 用于论文写作的主要AI模型调用

#### DeepSeek API（可选，用于风格分析增强）
- **API URL**: `https://api.deepseek.com/v1`
- **API Key**: 从DeepSeek官网获取的API密钥
- **用途**: 用于增强的期刊风格分析功能

在侧边栏分别配置这两个API的地址和密钥。

### 3. 开始写作

#### 完整工作流程：
1. **Tab 1**: 上传目标期刊范文（推荐，用于提取章节特定风格）
2. **Tab 2**: 导入Web of Science文献库（推荐，用于智能引用）
3. **Tab 3**: 一键写作流程
   - 📥 下载研究内容模板 (research_content_template.md)
   - 📝 按模板整理研究内容到Word文档
   - 📤 上传Word文档，系统自动解析并AI分析图表
   - 📚 选择文献库进行智能引用
   - ⚙️ 配置各章节AI模型（GPT/Claude）
   - 🚀 点击「开始全自动写作」

#### AI写作流程：
- **一级AI**: 分析研究内容+风格指南 → 生成详细写作skill
- **二级AI**: 同时参照skill和章节风格指南 + 句子级文献搜索 → 生成章节内容
- **一级AI**: 最终质量检查 → 对照章节特定风格指南进行微调

## 📖 功能模块详解

### Tab 1: 智能风格分析
上传目标期刊范文，系统进行深度分析：
- **章节特定提取**: 为每个章节生成专门的风格指南
- **写作模式识别**: 分析语言风格、句式偏好、术语使用
- **结构分析**: 提取各章节的段落组织和过渡方式
- **输出**: 详细的写作风格指南，用于指导AI写作

### Tab 2: 文献智能管理
建立高质量文献数据库，支持智能引用和质量优先选择。

#### 📤 Web of Science文献导出完整指南

##### 1. 🔍 搜索和筛选文献
- 访问 [Web of Science](https://clarivate.com/webofscience/)
- 使用关键词进行主题搜索（如："nitrogen cycling soil warming"）
- 设置时间范围（建议最近5-10年）
- 使用高级搜索优化结果质量

##### 2. 📋 选择文献
- 使用页面左侧的复选框选择相关文献
- 建议每次选择50-200篇文献（太多影响处理速度）
- 优先选择：
  - 高引用次数的经典文献
  - 最近发表的高质量论文
  - 领域内权威期刊的文章

##### 3. ⚙️ 导出设置（重要）
```
导出选项 (Export Options):
├── 文件格式: Plain Text File ⭐⭐⭐ (必须选择)
├── 记录内容: Full Record ⭐⭐⭐ (必须选择)
├── 文件编码: UTF-8 (推荐)
├── 每页记录数: 500 (可选，减少文件数量)
└── 其他选项: 保持默认
```

##### 4. 💾 下载和保存
- 点击"Export"按钮开始导出
- 保存为`.txt`格式文件
- 文件命名建议：`主题_年份_数量.txt`
- 示例：`nitrogen_soil_2024_150.txt`

#### 📁 支持的文件格式和要求

| 格式 | 支持程度 | 说明 |
|------|---------|------|
| **Plain Text File** | ✅ 完全支持 | 推荐格式，解析最完整 |
| **Full Record** | ✅ 必须选择 | 包含所有元数据字段 |
| **Brief/Abstract** | ❌ 不支持 | 缺少关键字段 |

#### 🔍 导出字段清单
Full Record格式包含：
- ✅ 标题 (TI)
- ✅ 作者及机构 (AU/AF)
- ✅ 摘要 (AB)
- ✅ 期刊信息 (SO)
- ✅ 出版年份 (PY)
- ✅ 卷号/期号 (VL/IS)
- ✅ 页码 (BP-EP)
- ✅ DOI (DI)
- ✅ 引用次数 (TC)
- ✅ 研究领域 (SC)

#### 🧠 智能解析和处理
系统自动执行：
- **文献解析**: 提取并结构化所有元数据
- **数据库构建**: 创建SQLite文献数据库
- **引用键生成**: 自动生成AuthorYear格式的citekey
- **质量评分**: 多维度评估文献质量
- **智能匹配**: 句子级相关性匹配

#### 💡 使用最佳实践

##### 文献库建设策略
- **主题相关性**: 只导入与研究高度相关的文献
- **质量优先**: 优先选择高影响力期刊的论文
- **时间覆盖**: 包含经典文献 + 最新研究
- **数量控制**: 每个库建议100-500篇文献

##### 文件管理建议
- **分主题建库**: 创建不同研究主题的独立文献库
- **定期更新**: 持续添加最新发表的文献
- **备份保存**: 保留原始导出文件以备重新导入
- **命名规范**: 使用描述性文件名便于管理

##### 引用优化技巧
- **多库选择**: 写作时可同时选择多个文献库
- **质量筛选**: 系统自动优先使用高质量文献
- **引用平衡**: 避免过度依赖单一作者或期刊
- **时效性**: 平衡经典文献和最新研究

### Tab 3: 两级AI写作系统

#### 🎯 工作流程：
1. **文档解析**: 智能提取研究内容，AI分析图表数据
2. **数据确认**: 验证提取的文本、表格、图片分析结果
3. **文献选择**: 多选文献库，系统自动整合
4. **模型配置**: 为各章节选择最适合的AI模型
5. **AI协作写作**:
   - **一级AI**: 生成详细写作skill（结构、要点、策略）
   - **二级AI**: 按skill精准写作 + 智能文献引用
   - **一级AI**: 最终质量检查，章节特定风格调整

#### 🤖 AI模型配置推荐：
| 章节 | 推荐模型 | 优势 |
|------|---------|------|
| 引言 | GPT-4o | 结构化写作，逻辑清晰 |
| 方法 | GPT-4o | 精确描述，技术细节 |
| 结果 | GPT-4o | 数据呈现，客观准确 |
| 讨论 | Claude-3.5 | 批判性分析，深度思考 |
| 摘要 | GPT-4o | 简洁总结，信息浓缩 |
| 结论 | Claude-3.5 | 综合推理，前瞻性思考 |

#### 📊 智能文献引用：
- **句子级搜索**: 为每个句子匹配1-3篇最相关文献
- **质量优先**: 优先经典、高引用、权威期刊论文
- **智能去重**: 避免同一文献重复引用
- **自动格式化**: 生成正确的LaTeX引用格式

## 📁 项目架构

```
paper_writer/
├── 🖥️ app.py                          # Streamlit主界面
├── 📝 research_content_template.md   # 研究内容整理模板
├── ⚙️ config/
│   └── config.yaml                   # 系统配置文件
├── 🧠 src/
│   ├── coordinator/
│   │   ├── multi_agent_coordinator.py  # 🎯 两级AI协调核心
│   │   └── skill_generator_agent.py   # 一级AI：skill生成器
│   ├── analyzer/
│   │   ├── journal_style_analyzer.py  # 章节特定风格分析
│   │   └── ai_deepseek_analyzer.py    # AI增强分析
│   ├── document_processor/
│   │   ├── word_analyzer.py           # Word文档深度解析
│   │   └── simple_parser.py           # 辅助解析器
│   ├── literature/
│   │   └── db_manager.py              # 智能文献管理
│   └── integrator/
│       └── draft_integrator.py        # 章节整合
├── 📚 sample_papers/                 # 风格分析范文PDF
├── 📄 literature_exports/            # WoS文献导出文件
├── 📤 output/                        # 生成结果目录
│   ├── style/                        # 风格分析报告
│   ├── sections/                     # 各章节LaTeX草稿
│   └── final/                        # 最终整合论文
└── 🔧 requirements.txt               # Python依赖
```

### 🏗️ 核心架构

#### 🎯 两级AI协作系统：
```
用户研究内容 + 期刊范文
           │
           ▼
    ┌─────────────┐
    │   一级AI    │ ← SkillGeneratorAgent (Claude-3.5)
    │ 生成写作skill│   - 分析研究内容和风格
    │ (结构+策略)  │   - 生成详细写作指导
    └─────────────┘
           │
           ▼
    ┌─────────────┐
    │   二级AI    │ ← 各章节Agent (GPT/Claude)
    │ 精准写作    │   - 同时参照skill和风格指南
    │ +智能引用   │   - 按skill结构组织内容
    │             │   - 按风格指南规范表达
    └─────────────┘   - 句子级文献搜索
           │
           ▼
    ┌─────────────┐
    │   一级AI    │ ← 最终质量检查
    │ 风格调整    │   - 章节特定风格对照
    │ (微调)      │   - 保持内容，优化表达
    └─────────────┘
           │
           ▼
    最终学术论文 (LaTeX格式)
```

## 🛠️ 安装依赖

```bash
pip install -r requirements.txt

# 可选：spacy模型（用于NLP处理）
python -m spacy download en_core_web_sm
```

## ⚙️ 配置说明

编辑 `config/config.yaml`：

```yaml
# 主要模型API配置（用于论文写作）
api:
  base_url: "https://modelgate.cn/v1"      # ModelGate或其他模型中转站地址
  api_key: "your_modelgate_api_key"        # ModelGate API密钥

# DeepSeek API配置（用于风格分析增强，可选）
deepseek:
  base_url: "https://api.deepseek.com/v1"  # DeepSeek API地址
  api_key: "your_deepseek_api_key"         # DeepSeek API密钥

# 各章节默认模型配置
models:
  introduction: "GPT-4o"
  methods: "GPT-4o"
  results: "GPT-4o"
  discussion: "Claude-Sonnet-4.5"
  abstract: "GPT-4o"
  conclusion: "Claude-Sonnet-4.5"

# 文档处理配置
document_processing:
  max_image_size: "2048x2048"
  table_analysis_limit: 100
```

## 💡 使用指南

### 📋 最佳实践

1. **研究内容准备**
   - 下载`research_content_template.md`模板
   - 按模板结构完整整理研究内容到Word文档
   - 确保包含所有必要的数据表格和图表

2. **范文上传（强烈推荐）**
   - 上传目标期刊的完整论文PDF
   - 系统会提取章节特定的写作风格
   - 确保最终输出符合期刊规范

3. **文献库建设**
   - 从Web of Science导出Full Record格式的文献
   - 建立领域相关的文献数据库
   - 系统会进行智能引用匹配

4. **AI模型选择策略**
   - **GPT-4o**: 适合结构化写作（引言、方法、结果、摘要）
   - **Claude-3.5**: 适合深度分析（讨论、结论、复杂推理）
   - **混合使用**: 不同章节使用最适合的模型

### 🎯 AI协作优势

- **一级AI**: 提供个性化写作指导，考虑研究内容特点
- **二级AI**: 精准执行，智能文献匹配，确保学术质量
- **最终检查**: 章节特定风格调整，保证风格一致性

### ⚡ 质量保证

- **句子级引用**: 每个句子都有最相关的文献支撑
- **质量优先**: 优先选择经典和高影响力论文
- **风格一致**: 各章节符合对应期刊风格要求
- **LaTeX输出**: 直接生成出版级别的格式

## 🧠 AI架构详解

### 🎯 两级AI协作机制

#### 一级AI：智能规划师
- **角色**: SkillGeneratorAgent (基于Claude-3.5)
- **职能**:
  - 分析用户研究内容和期刊风格指南
  - 生成章节特定的详细写作skill
  - 制定写作结构、要点、引用策略
- **输出**: 包含结构、内容、策略的完整skill文档

#### 二级AI：专业写手
- **角色**: IntroductionAgent, MethodsAgent等 (GPT/Claude)
- **职能**:
  - **同时参照skill文件和章节风格指南进行写作**
  - 按skill结构组织内容，按风格指南规范表达
  - 进行句子级文献智能搜索
  - 生成符合学术规范的内容
- **输出**: 高质量的章节内容

#### 质量检查AI：最终审阅者
- **角色**: SkillGeneratorAgent (复用一级AI)
- **职能**:
  - 对照章节特定风格指南进行检查
  - 发现不符合要求的表达进行微调
  - 确保最终输出完全符合期刊标准
- **输出**: 经过风格优化的最终版本

### 📊 智能文献系统

#### 搜索策略
- **粒度**: 句子级 (而非章节级)
- **质量评估**: 引用次数 + 发表年份 + 期刊影响力 + 标题质量 + 作者数量
- **选择标准**: 每句1-3篇最相关的高质量文献

#### 引用生成
- **自动格式化**: 生成正确的LaTeX引用命令
- **智能去重**: 避免文献重复引用
- **质量保证**: 每个引用都有实际依据

## 📦 技术依赖

### 核心依赖
- **Python 3.9+**
- **streamlit >= 1.28.0** - Web界面框架
- **pandas >= 1.5.0** - 数据处理
- **python-docx >= 0.8.11** - Word文档解析
- **PyMuPDF >= 1.23.0** - PDF处理
- **requests >= 2.31.0** - API调用
- **spacy >= 3.7.0** - 自然语言处理

### AI模型支持
- **openai >= 1.0.0** - OpenAI GPT模型
- **anthropic-sdk >= 0.2.0** - Claude模型 (可选)

### 可选增强功能
- **nltk >= 3.8.0** - 文本处理增强
- **scikit-learn >= 1.3.0** - 文本相似度计算

### 安装命令
```bash
pip install -r requirements.txt
python -m spacy download en_core_web_sm  # NLP模型
```

## 🌟 项目特色

### 🚀 技术创新
- **两级AI协作**: 智能规划 + 精准执行的创新架构
- **章节特定分析**: 各章节使用专用风格指南
- **句子级文献搜索**: 超细粒度的学术引用匹配
- **质量优先算法**: 多维度文献质量评估系统

### 📚 学术规范
- **LaTeX原生输出**: 直接生成出版级格式
- **严格引用要求**: 基于内容的智能引用生成
- **风格一致性**: 各章节符合期刊特定规范
- **学术质量保证**: 多轮AI检查确保专业水准

### 💡 用户体验
- **一键操作**: 从文档上传到论文生成的完整流程
- **智能解析**: AI深度理解研究内容和图表
- **灵活配置**: 支持多模型、多文献库选择
- **实时反馈**: 写作进度和质量实时展示

## 📞 技术支持

- **邮箱**: sjs@cau.edu.cn
- **GitHub**: https://github.com/jiangye999/SCI-Writting-Agenet
- **Issues**: 欢迎提交问题和建议
- **PR**: 欢迎贡献代码改进

---

*基于先进AI技术的学术论文智能写作助手，让论文写作变得简单、专业、高效。*

## 📄 许可证

MIT License
